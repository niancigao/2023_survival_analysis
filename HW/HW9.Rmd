---
title: "Time Series HW9"
author: "B082040005 高念慈"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=F, results='hide', message=FALSE, warning=FALSE}
# require(quantmod)  # 股價
require(moments)   # 偏、峰度
# install.packages("TSA")
library(fBasics)
# install.packages('https://cran.r-project.org/src/contrib/Archive/normtest/normtest_1.1.tar.gz')
library(normtest)

library(TSA)

# library(ggplot2)

```

## 2.
Consider the monthly simple returns of the Decile 1, Decile 2, Decile <br>
9, and Decile 10 of NYSE/AMEX/NASDAQ (紐約證券交易所/美國證券交易所/納斯達克) <br>
based on market capitalization (市值). The data span is from January 1970 to December 2008, <br>
and the data are obtained from CRSP.

```{r}
data2 = read.table("C:/Users/user/Desktop/time_series/HW/m-deciles08.txt", header=T)
head(data2)
```

### (a) 
For the return series of Decile 2 and Decile 10, test the null hypothesis <br>
that the first 12 lags of autocorrelations are zero at the 5% level. <br> 
Draw your conclusion.

```{r}
Decile_2 = data2[,3]
Box.test(Decile_2,lag=12,type="Ljung-Box")
```

According to the p-value < 0.05 , <br>
we reject the H0 is such that the first 12 lags of Decile_2 autocorrelations <br> 
have some nonzero terms .(Thus, the time series of Decile_2 is not a white noise.)

```{r}
Decile_10 = data2[,5]
Box.test(Decile_10,lag = 12,type = "Ljung-Box")
```

According to the p-value > 0.05 , we accept the null hypothesis <br> 
the first 12 lags of Decile_10 autocorrelations are zero. <br>
(Considered as white noise process)

### (b) 
Build an ARMA model for the return series of Decile 2. Perform(執行) model <br>
checking and write down the fitted model.

```{r}
ts_Decile_2 = ts(Decile_2,frequency=12,start=c(1970,1))
model1 = ar(ts_Decile_2,method = "mle")
model1$order
```

```{r}
m1 = arima(ts_Decile_2,order = c(12,0,0))
phi_0 = (1-sum(m1$coef[1:12]))*mean(Decile_2)
phi_0
```

```{r}
round(m1$coef,5)
m1$sigma2
```

$Rt = 0.00814 + 0.21028Rt−1 − 0.07803Rt−2 − 0.03588Rt−3 + 0.00285Rt−4 − 0.04375Rt−5 − 0.00239Rt−6 + 0.00262Rt−7 − 0.07878Rt−8 − 0.01953Rt−9 + 0.06895Rt−10 − 0.04536Rt−11 + 0.24471Rt−12 + at , σ = 0.0038$

# 係數沒fixed
# residual 沒檢定

### (c) 
Use the fitted ARMA model to produce 1-to 12-step-ahead forecasts of the <br>
series and the associated standard errors of forecasts.

```{r}
forecast2 = predict(m1,n.ahead = 12)
forecast2
```

## 3.
Consider the monthly log returns of CRSP equal-weighted index from <br> 
January 1962 to December 1999 for 456 observations. You may obtain <br>
the data from CRSP directly or from the file m- ew6299.txt on the Web.

```{r}
data_mew6299 = read.table('https://faculty.chicagobooth.edu/-/media/faculty/ruey-s-tsay/teaching/fts3/m-ew6299.txt')
head(data_mew6299)
```

```{r}
library(TSA)
eacf(data_mew6299[,1])
acf(data_mew6299)
pacf(data_mew6299)
```

### (a)
Build an AR model for the series and check the fitted model.

```{r}
m4=ar(data_mew6299[,1],method = "mle")
m4$order

model3 = arima(data_mew6299[,1],order=c(1,0,0))
model3
```

```{r}
phi_0 = (1-sum(model3$coef[1]))*1.0626
rbind(phi_0=phi_0) # phi_0 as the intercept of AR(1) model
rbind(sigma_a = sqrt(model3$sigma2))
```

+ $AR(1)\; model : rt = 0.8218 + 0.2267rt−1 + at, σa = 5.448$

### (b)
Build an MA model for the series and check the fitted model.

```{r}
model4 = arima(data_mew6299[,1],order=c(0,0,1))
model4
```

```{r}
rbind(sigma_a=sqrt(model4$sigma2))
```

+ $MA(1) \; model : rt = 1.0605 + at + 0.2385at−1 , σa = 5.439$

### (c)
Compute 1- and 2-step-ahead forecasts of the AR and MA models built in the 
previous two questions.

+ $AR(1)$

```{r}
forecast1=predict(model3,n.ahead = 2)
forecast1
```

+ $MA(1)$ 

```{r}
forecast2=predict(model4,n.ahead = 2)
forecast2
```

### (d) 
Compare the fitted AR and MA models.

$$AR(1)\; model : (1 − 0.2267B)rt = 0.8218 + at$$
long division

$$ ∵ \frac{1}{1 − \phi_1 B} = 1 + \phi_1 B + \phi_1^2B^2 + \phi_1^3B^3...$$
$$ ∴ MA \; representation \;of \;AR(1) model = \frac{0.8218}{1 − 0.2267}+ a_t(1 + 0.2267B + 0.2267^2B^2+...)$$

$$= 1.063 + a_t + 0.2267a_{t-1} + 0.0514a_{t-2} + 0.0117a_{t-3} +...$$
$$( MA(1)\; model : rt = 1.0605 + at + 0.2385a_{t−1} , σa = 5.439 )$$

+ Thus, AR(1) model and MR(1) model are basically the same
+ and equally adequate to the time series of log return of m-ew6299 data.

---
---
